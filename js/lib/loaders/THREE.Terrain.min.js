/**
 * THREE.Terrain.js 1.6.0-20180415
 *
 * @author Isaac Sukin (http://www.isaacsukin.com/)
 * @license MIT
 */

!function(a){function b(a,b,c){this.x=a,this.y=b,this.z=c}function c(a){return a*a*a*(a*(6*a-15)+10)}function d(a,b,c){return(1-c)*a+c*b}var e=a.noise={};b.prototype.dot2=function(a,b){return this.x*a+this.y*b},b.prototype.dot3=function(a,b,c){return this.x*a+this.y*b+this.z*c};var f=[new b(1,1,0),new b(-1,1,0),new b(1,-1,0),new b(-1,-1,0),new b(1,0,1),new b(-1,0,1),new b(1,0,-1),new b(-1,0,-1),new b(0,1,1),new b(0,-1,1),new b(0,1,-1),new b(0,-1,-1)],g=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],h=new Array(512),i=new Array(512);e.seed=function(a){a>0&&a<1&&(a*=65536),a=Math.floor(a),a<256&&(a|=a<<8);for(var b=0;b<256;b++){var c;c=1&b?g[b]^255&a:g[b]^a>>8&255,h[b]=h[b+256]=c,i[b]=i[b+256]=f[c%12]}},e.seed(Math.random());var j=.5*(Math.sqrt(3)-1),k=(3-Math.sqrt(3))/6,l=1/3,m=1/6;e.simplex=function(a,b){var c,d,e,f=(a+b)*j,g=Math.floor(a+f),l=Math.floor(b+f),m=(g+l)*k,n=a-g+m,o=b-l+m,p,q;n>o?(p=1,q=0):(p=0,q=1);var r=n-p+k,s=o-q+k,t=n-1+2*k,u=o-1+2*k;g&=255,l&=255;var v=i[g+h[l]],w=i[g+p+h[l+q]],x=i[g+1+h[l+1]],y=.5-n*n-o*o;y<0?c=0:(y*=y,c=y*y*v.dot2(n,o));var z=.5-r*r-s*s;z<0?d=0:(z*=z,d=z*z*w.dot2(r,s));var A=.5-t*t-u*u;return A<0?e=0:(A*=A,e=A*A*x.dot2(t,u)),70*(c+d+e)},e.perlin=function(a,b){var e=Math.floor(a),f=Math.floor(b);a-=e,b-=f,e&=255,f&=255;var g=i[e+h[f]].dot2(a,b),j=i[e+h[f+1]].dot2(a,b-1),k=i[e+1+h[f]].dot2(a-1,b),l=i[e+1+h[f+1]].dot2(a-1,b-1),m=c(a);return d(d(g,k,m),d(j,l,m),c(b))}}(this),THREE.Terrain=function(a){var b={after:null,easing:THREE.Terrain.Linear,heightmap:THREE.Terrain.DiamondSquare,material:null,maxHeight:100,minHeight:-100,optimization:THREE.Terrain.NONE,frequency:2.5,steps:1,stretch:!0,turbulent:!1,useBufferGeometry:!1,xSegments:63,xSize:1024,ySegments:63,ySize:1024,_mesh:null};a=a||{};for(var c in b)b.hasOwnProperty(c)&&(a[c]=void 0===a[c]?b[c]:a[c]);a.material=a.material||new THREE.MeshBasicMaterial({color:15623731});var d=new THREE.Object3D;d.rotation.x=-.5*Math.PI;var e=a._mesh;if(e&&"PlaneGeometry"===e.geometry.type&&e.geometry.parameters.widthSegments===a.xSegments&&e.geometry.parameters.heightSegments===a.ySegments){e.material=a.material,e.scale.x=a.xSize/e.geometry.parameters.width,e.scale.y=a.ySize/e.geometry.parameters.height;for(var f=0,g=e.geometry.vertices.length;f<g;f++)e.geometry.vertices[f].z=0}else e=new THREE.Mesh(new THREE.PlaneGeometry(a.xSize,a.ySize,a.xSegments,a.ySegments),a.material);return delete a._mesh,a.heightmap instanceof HTMLCanvasElement||a.heightmap instanceof Image?THREE.Terrain.fromHeightmap(e.geometry.vertices,a):"function"==typeof a.heightmap?a.heightmap(e.geometry.vertices,a):console.warn("An invalid value was passed for `options.heightmap`: "+a.heightmap),THREE.Terrain.Normalize(e,a),a.useBufferGeometry&&(e.geometry=(new THREE.BufferGeometry).fromGeometry(e.geometry)),d.add(e),d},THREE.Terrain.Normalize=function(a,b){var c=a.geometry.vertices;b.turbulent&&THREE.Terrain.Turbulence(c,b),b.steps>1&&(THREE.Terrain.Step(c,b.steps),THREE.Terrain.Smooth(c,b)),THREE.Terrain.Clamp(c,b),"function"==typeof b.after&&b.after(c,b),a.geometry.verticesNeedUpdate=!0,a.geometry.normalsNeedUpdate=!0,a.geometry.computeBoundingSphere(),a.geometry.computeFaceNormals(),a.geometry.computeVertexNormals()},THREE.Terrain.NONE=0,THREE.Terrain.GEOMIPMAP=1,THREE.Terrain.GEOCLIPMAP=2,THREE.Terrain.POLYGONREDUCTION=3,THREE.Terrain.toArray2D=function(a,b){var c=new Array(b.xSegments),d=b.xSegments+1,e=b.ySegments+1,f,g;for(f=0;f<d;f++)for(c[f]=new Float64Array(b.ySegments),g=0;g<e;g++)c[f][g]=a[g*d+f].z;return c},THREE.Terrain.fromArray2D=function(a,b){for(var c=0,d=b.length;c<d;c++)for(var e=0,f=b[c].length;e<f;e++)a[e*d+c].z=b[c][e]},THREE.Terrain.toArray1D=function(a){for(var b=new Float64Array(a.length),c=0,d=b.length;c<d;c++)b[c]=a[c].z;return b},THREE.Terrain.fromArray1D=function(a,b){for(var c=0,d=Math.min(a.length,b.length);c<d;c++)a[c].z=b[c]},THREE.Terrain.heightmapArray=function(a,b){var c=new Array((b.xSegments+1)*(b.ySegments+1)),d=c.length,e;for(e=0;e<d;e++)c[e]={z:0};for(b.minHeight=b.minHeight||0,b.maxHeight=void 0===b.maxHeight?1:b.maxHeight,b.stretch=b.stretch||!1,a(c,b),THREE.Terrain.Clamp(c,b),e=0;e<d;e++)c[e]=c[e].z;return c},THREE.Terrain.Linear=function(a){return a},THREE.Terrain.EaseIn=function(a){return a*a},THREE.Terrain.EaseOut=function(a){return-a*(a-2)},THREE.Terrain.EaseInOut=function(a){return a*a*(3-2*a)},THREE.Terrain.InEaseOut=function(a){var b=2*a-1;return.5*b*b*b+.5},THREE.Terrain.EaseInWeak=function(a){return Math.pow(a,1.55)},THREE.Terrain.EaseInStrong=function(a){return a*a*a*a*a*a*a},THREE.Terrain.fromHeightmap=function(a,b){var c=document.createElement("canvas"),d=c.getContext("2d"),e=b.ySegments+1,f=b.xSegments+1,g=b.maxHeight-b.minHeight;c.width=f,c.height=e,d.drawImage(b.heightmap,0,0,c.width,c.height);for(var h=d.getImageData(0,0,c.width,c.height).data,i=0;i<e;i++)for(var j=0;j<f;j++){var k=i*f+j,l=4*k;a[k].z=(h[l]+h[l+1]+h[l+2])/765*g+b.minHeight}},THREE.Terrain.toHeightmap=function(a,b){var c=void 0===b.maxHeight,d=void 0===b.minHeight,e=c?b.maxHeight:-1/0,f=d?b.minHeight:1/0;if(!c||!d){for(var g=e,h=f,i=0,j=a.length;i<j;i++)a[i].z>g&&(g=a[i].z),a[i].z<h&&(h=a[i].z);c||(e=g),d||(f=h)}var k=b.heightmap instanceof HTMLCanvasElement?b.heightmap:document.createElement("canvas"),l=k.getContext("2d"),m=b.ySegments+1,n=b.xSegments+1,o=b.maxHeight-b.minHeight;k.width=n,k.height=m;for(var p=l.createImageData(k.width,k.height),q=p.data,r=0;r<m;r++)for(var s=0;s<n;s++){var t=r*n+s,u=4*t;q[u]=q[u+1]=q[u+2]=Math.round((a[t].z-b.minHeight)/o*255),q[u+3]=255}return l.putImageData(p,0,0),k},THREE.Terrain.Clamp=function(a,b){var c=1/0,d=-1/0,e=a.length,f;for(b.easing=b.easing||THREE.Terrain.Linear,f=0;f<e;f++)a[f].z<c&&(c=a[f].z),a[f].z>d&&(d=a[f].z);var g=d-c,h="number"!=typeof b.maxHeight?d:b.maxHeight,i="number"!=typeof b.minHeight?c:b.minHeight,j=b.stretch?h:d<h?d:h,k=b.stretch?i:c>i?c:i,l=j-k;for(j<k&&(j=h,l=j-k),f=0;f<e;f++)a[f].z=b.easing((a[f].z-c)/g)*l+i},THREE.Terrain.Edges=function(a,b,c,d,e,f){var g=Math.floor(d/(b.xSize/b.xSegments))||1,h=Math.floor(d/(b.ySize/b.ySegments))||1,i=c?b.maxHeight:b.minHeight,j=c?Math.max:Math.min,k=b.xSegments+1,l=b.ySegments+1,m,n,o,p,q;for(e=e||THREE.Terrain.EaseInOut,"object"!=typeof f&&(f={top:!0,bottom:!0,left:!0,right:!0}),m=0;m<k;m++)for(n=0;n<h;n++)o=e(1-n/h),p=n*k+m,q=(b.ySegments-n)*k+m,f.top&&(a[p].z=j(a[p].z,(i-a[p].z)*o+a[p].z)),f.bottom&&(a[q].z=j(a[q].z,(i-a[q].z)*o+a[q].z));for(m=0;m<l;m++)for(n=0;n<g;n++)o=e(1-n/g),p=m*k+n,q=(b.ySegments-m)*k+(b.xSegments-n),f.left&&(a[p].z=j(a[p].z,(i-a[p].z)*o+a[p].z)),f.right&&(a[q].z=j(a[q].z,(i-a[q].z)*o+a[q].z));THREE.Terrain.Clamp(a,{maxHeight:b.maxHeight,minHeight:b.minHeight,stretch:!0})},THREE.Terrain.RadialEdges=function(a,b,c,d,e){var f=c?b.maxHeight:b.minHeight,g=c?Math.max:Math.min,h=b.xSegments+1,i=b.ySegments+1,j=.5*h,k=.5*i,l=b.xSize/b.xSegments,m=b.ySize/b.ySegments,n=.5*Math.min(b.xSize,b.ySize)-d,o,p,q,r,s;for(o=0;o<h;o++)for(p=0;p<k;p++)r=p*h+o,s=Math.min(n,Math.sqrt((j-o)*l*(j-o)*l+(k-p)*m*(k-p)*m)-d),s<0||(q=e(s/n),a[r].z=g(a[r].z,(f-a[r].z)*q+a[r].z),r=(b.ySegments-p)*h+o,a[r].z=g(a[r].z,(f-a[r].z)*q+a[r].z))},THREE.Terrain.Smooth=function(a,b,c){for(var d=new Float64Array(a.length),e=0,f=b.xSegments+1,g=b.ySegments+1;e<f;e++)for(var h=0;h<g;h++){for(var i=0,j=0,k=-1;k<=1;k++)for(var l=-1;l<=1;l++){var m=(h+k)*f+e+l;void 0!==a[m]&&e+l>=0&&h+k>=0&&e+l<f&&h+k<g&&(i+=a[m].z,j++)}d[h*f+e]=i/j}c=c||0;for(var n=1/(1+c),o=0,p=a.length;o<p;o++)a[o].z=(d[o]+a[o].z*c)*n},THREE.Terrain.SmoothMedian=function(a,b){for(var c=new Float64Array(a.length),d=[],e=[],f=function(a,b){return d[a]-d[b]},g=0,h=b.xSegments+1,i=b.ySegments+1;g<h;g++)for(var j=0;j<i;j++){d.length=0,e.length=0;for(var k=-1;k<=1;k++)for(var l=-1;l<=1;l++){var m=(j+k)*h+g+l;void 0!==a[m]&&g+l>=0&&j+k>=0&&g+l<h&&j+k<i&&(d.push(a[m].z),e.push(m))}e.sort(f);var n=Math.floor(.5*e.length),o;o=e.length%2==1?a[e[n]].z:.5*(a[e[n-1]].z+a[e[n]].z),c[j*h+g]=o}for(var p=0,q=a.length;p<q;p++)a[p].z=c[p]},THREE.Terrain.SmoothConservative=function(a,b,c){for(var d=new Float64Array(a.length),e=0,f=b.xSegments+1,g=b.ySegments+1;e<f;e++)for(var h=0;h<g;h++){for(var i=-1/0,j=1/0,k=-1;k<=1;k++)for(var l=-1;l<=1;l++){var m=(h+k)*f+e+l;void 0!==a[m]&&k&&l&&e+l>=0&&h+k>=0&&e+l<f&&h+k<g&&(a[m].z<j&&(j=a[m].z),a[m].z>i&&(i=a[m].z))}var n=h*f+e;if("number"==typeof c){var o=.5*(i-j),p=j+o;i=p+o*c,j=p-o*c}d[n]=a[n].z>i?i:a[n].z<j?j:a[n].z}for(var q=0,r=a.length;q<r;q++)a[q].z=d[q]},THREE.Terrain.Step=function(a,b){var c=0,d=0,e=a.length,f=Math.floor(e/b),g=new Array(e),h=new Array(b);for(void 0===b&&(b=Math.floor(Math.pow(.5*e,.25))),c=0;c<e;c++)g[c]=a[c].z;for(g.sort(function(a,b){return a-b}),c=0;c<b;c++){var i=g.slice(c*f,(c+1)*f),j=0,k=i.length;for(d=0;d<k;d++)j+=i[d];h[c]={min:i[0],max:i[i.length-1],avg:j/k}}for(c=0;c<e;c++){var l=a[c].z;for(d=0;d<b;d++)if(l>=h[d].min&&l<=h[d].max){a[c].z=h[d].avg;break}}},THREE.Terrain.Turbulence=function(a,b){for(var c=b.maxHeight-b.minHeight,d=0,e=a.length;d<e;d++)a[d].z=b.minHeight+Math.abs(2*(a[d].z-b.minHeight)-c)},THREE.Terrain.MultiPass=function(a,b,c){var d={};for(var e in b)b.hasOwnProperty(e)&&(d[e]=b[e]);for(var f=b.maxHeight-b.minHeight,g=0,h=c.length;g<h;g++){var i=void 0===c[g].amplitude?1:c[g].amplitude,j=.5*(f-f*i);d.maxHeight=b.maxHeight-j,d.minHeight=b.minHeight+j,d.frequency=void 0===c[g].frequency?b.frequency:c[g].frequency,c[g].method(a,d)}},THREE.Terrain.Curve=function(a,b,c){for(var d=.5*(b.maxHeight-b.minHeight),e=b.frequency/(Math.min(b.xSegments,b.ySegments)+1),f=0,g=b.xSegments+1,h=b.ySegments+1;f<g;f++)for(var i=0;i<h;i++)a[i*g+f].z+=c(f*e,i*e)*d},THREE.Terrain.Cosine=function(a,b){for(var c=.5*(b.maxHeight-b.minHeight),d=b.frequency*Math.PI/(Math.min(b.xSegments,b.ySegments)+1),e=Math.random()*Math.PI*2,f=0,g=b.xSegments+1;f<g;f++)for(var h=0,i=b.ySegments+1;h<i;h++)a[h*g+f].z+=c*(Math.cos(f*d+e)+Math.cos(h*d+e))},THREE.Terrain.CosineLayers=function(a,b){THREE.Terrain.MultiPass(a,b,[{method:THREE.Terrain.Cosine,frequency:2.5},{method:THREE.Terrain.Cosine,amplitude:.1,frequency:12},{method:THREE.Terrain.Cosine,amplitude:.05,frequency:15},{method:THREE.Terrain.Cosine,amplitude:.025,frequency:20}])},THREE.Terrain.DiamondSquare=function(a,b){var c=THREE.Math.nextPowerOfTwo(Math.max(b.xSegments,b.ySegments)+1),d=c+1,e=[],f=b.maxHeight-b.minHeight,g,h,i=b.xSegments+1,j=b.ySegments+1;for(g=0;g<=c;g++)e[g]=new Float64Array(c+1);for(var k=c;k>=2;k/=2){var l=Math.round(.5*k),m=Math.round(k),n,o,p,q,r;for(f/=2,n=0;n<c;n+=m)for(o=0;o<c;o+=m)q=Math.random()*f*2-f,p=e[n][o]+e[n+m][o]+e[n][o+m]+e[n+m][o+m],p*=.25,e[n+l][o+l]=p+q;for(n=0;n<c;n+=l)for(o=(n+l)%k;o<c;o+=k)q=Math.random()*f*2-f,p=e[(n-l+d)%d][o]+e[(n+l)%d][o]+e[n][(o+l)%d]+e[n][(o-l+d)%d],p*=.25,p+=q,e[n][o]=p,0===n&&(e[c][o]=p),0===o&&(e[n][c]=p)}for(g=0;g<i;g++)for(h=0;h<j;h++)a[h*i+g].z+=e[g][h]},THREE.Terrain.Fault=function(a,b){for(var c=Math.sqrt(b.xSegments*b.xSegments+b.ySegments*b.ySegments),d=c*b.frequency,e=.5*(b.maxHeight-b.minHeight),f=e/d,g=Math.min(b.xSize/b.xSegments,b.ySize/b.ySegments)*b.frequency,h=0;h<d;h++)for(var i=Math.random(),j=Math.sin(i*Math.PI*2),k=Math.cos(i*Math.PI*2),l=Math.random()*c-.5*c,m=0,n=b.xSegments+1;m<n;m++)for(var o=0,p=b.ySegments+1;o<p;o++){var q=j*m+k*o-l;q>g?a[o*n+m].z+=f:q<-g?a[o*n+m].z-=f:a[o*n+m].z+=Math.cos(q/g*Math.PI*2)*f}},THREE.Terrain.Hill=function(a,b,c,d){var e=2*b.frequency,f=e*e*10,g=b.maxHeight-b.minHeight,h=g/(e*e),i=g/e,j=Math.min(b.xSize,b.ySize),k=j/(e*e),l=j/e;c=c||THREE.Terrain.Influences.Hill;for(var m={x:0,y:0},n=0;n<f;n++){var o=Math.random()*(l-k)+k,p=Math.random()*(i-h)+h,q=0-o,r=b.xSize+o,s=b.ySize+o;m.x=Math.random(),m.y=Math.random(),"function"==typeof d&&d(m),THREE.Terrain.Influence(a,b,c,m.x,m.y,o,p,THREE.AdditiveBlending,THREE.Terrain.EaseInStrong)}},THREE.Terrain.HillIsland=function(){var a=function(a){var b=Math.random()*Math.PI*2;a.x=.5+Math.cos(b)*a.x*.4,a.y=.5+Math.sin(b)*a.y*.4};return function(b,c,d){THREE.Terrain.Hill(b,c,d,a)}}(),function(){function a(b,c,d,e,f){for(var g=d*e+c,h=0;h<3;h++){switch(Math.floor(8*Math.random())){case 0:c++;break;case 1:c--;break;case 2:d++;break;case 3:d--;break;case 4:c++,d++;break;case 5:c++,d--;break;case 6:c--,d++;break;case 7:c--,d--;break}var i=d*e+c;if(void 0!==b[i]){if(b[i].z<b[g].z)return a(b,c,d,e,f),void 0}else if(Math.random()<.2)return b[g].z+=f,void 0}b[g].z+=f}THREE.Terrain.Particles=function(b,c){for(var d=Math.sqrt(c.xSegments*c.xSegments+c.ySegments*c.ySegments)*c.frequency*300,e=c.xSegments+1,f=(c.maxHeight-c.minHeight)/d*1e3,g=Math.floor(Math.random()*c.xSegments),h=Math.floor(Math.random()*c.ySegments),i=.2*Math.random()-.1,j=.2*Math.random()-.1,k=0;k<d;k++){a(b,g,h,e,f);var l=Math.random()*Math.PI*2;k%1e3==0&&(i=.2*Math.random()-.1,j=.2*Math.random()-.1),k%100==0&&(g=Math.floor(c.xSegments*(.5+i)+Math.cos(l)*Math.random()*c.xSegments*(.5-Math.abs(i))),h=Math.floor(c.ySegments*(.5+j)+Math.sin(l)*Math.random()*c.ySegments*(.5-Math.abs(j))))}}}(),THREE.Terrain.Perlin=function(a,b){noise.seed(Math.random());for(var c=.5*(b.maxHeight-b.minHeight),d=(Math.min(b.xSegments,b.ySegments)+1)/b.frequency,e=0,f=b.xSegments+1;e<f;e++)for(var g=0,h=b.ySegments+1;g<h;g++)a[g*f+e].z+=noise.perlin(e/d,g/d)*c},THREE.Terrain.PerlinDiamond=function(a,b){THREE.Terrain.MultiPass(a,b,[{method:THREE.Terrain.Perlin},{method:THREE.Terrain.DiamondSquare,amplitude:.75},{method:function(a,b){return THREE.Terrain.SmoothMedian(a,b)}}])},THREE.Terrain.PerlinLayers=function(a,b){THREE.Terrain.MultiPass(a,b,[{method:THREE.Terrain.Perlin,frequency:1.25},{method:THREE.Terrain.Perlin,amplitude:.05,frequency:2.5},{method:THREE.Terrain.Perlin,amplitude:.35,frequency:5},{method:THREE.Terrain.Perlin,amplitude:.15,frequency:10}])},THREE.Terrain.Simplex=function(a,b){noise.seed(Math.random());for(var c=.5*(b.maxHeight-b.minHeight),d=2*(Math.min(b.xSegments,b.ySegments)+1)/b.frequency,e=0,f=b.xSegments+1;e<f;e++)for(var g=0,h=b.ySegments+1;g<h;g++)a[g*f+e].z+=noise.simplex(e/d,g/d)*c},THREE.Terrain.SimplexLayers=function(a,b){THREE.Terrain.MultiPass(a,b,[{method:THREE.Terrain.Simplex,frequency:1.25},{method:THREE.Terrain.Simplex,amplitude:.5,frequency:2.5},{method:THREE.Terrain.Simplex,amplitude:.25,frequency:5},{method:THREE.Terrain.Simplex,amplitude:.125,frequency:10},{method:THREE.Terrain.Simplex,amplitude:.0625,frequency:20}])},function(){function a(a,b,c,d,e,f){if(!(c>d)){var g=0,h=0,i=d,j=d,k=Math.floor(d/c),l=-k,m=-k;for(g=0;g<=i;g+=k){for(h=0;h<=j;h+=k){var n=h*i+g;if(f[n]=Math.random()*e,!(l<0&&m<0)){for(var o=f[n],p=f[h*i+(g-k)]||o,q=f[(h-k)*i+g]||o,r=f[(h-k)*i+(g-k)]||o,s=l;s<g;s++)for(var t=m;t<h;t++)if(s!==l||t!==m){var u=t*i+s;if(!(u<0)){var v=(s-l)/k,w=(t-m)/k,x=v*q+(1-v)*r,y=v*o+(1-v)*p;f[u]=w*y+(1-w)*x}}m=h}}l=g,m=-k}for(g=0,i=b.xSegments+1;g<i;g++)for(h=0,j=b.ySegments+1;h<j;h++){var z=h*i+g,A=h*d+g;a[z].z+=f[A]}}}THREE.Terrain.Value=function(b,c){for(var d=THREE.Math.nextPowerOfTwo(Math.max(c.xSegments,c.ySegments)+1),e=new Float64Array((d+1)*(d+1)),f=c.maxHeight-c.minHeight,g=2;g<7;g++)a(b,c,Math.pow(2,g),d,f*Math.pow(2,2.4-1.2*g),e);THREE.Terrain.Clamp(b,{maxHeight:c.maxHeight,minHeight:c.minHeight,stretch:!0})}}(),THREE.Terrain.Weierstrass=function(a,b){for(var c=.5*(b.maxHeight-b.minHeight),d=Math.random()<.5?1:-1,e=Math.random()<.5?1:-1,f=.5+1*Math.random(),g=.5+1*Math.random(),h=.025+.1*Math.random(),i=2*Math.random()-1,j=.5+1*Math.random(),k=.5+1*Math.random(),l=.025+.1*Math.random(),m=2*Math.random()-1,n=0,o=b.xSegments+1;n<o;n++)for(var p=0,q=b.ySegments+1;p<q;p++){for(var r=0,s=0;s<20;s++){var t=Math.pow(1+f,-s)*Math.sin(Math.pow(1+g,s)*(n+.25*Math.cos(p)+i*p)*h),u=Math.pow(1+j,-s)*Math.sin(Math.pow(1+k,s)*(p+.25*Math.cos(n)+m*n)*l);r-=Math.exp(d*t*t+e*u*u)}a[p*o+n].z+=r*c}THREE.Terrain.Clamp(a,b)},THREE.Terrain.generateBlendedMaterial=function(a){function b(a){return a===(0|a)?a+".0":a+""}for(var c=THREE.UniformsUtils.merge([THREE.ShaderLib.lambert.uniforms]),d="",e="",f=a[0].texture.repeat,g=a[0].texture.offset,h=0,i=a.length;h<i;h++)if(a[h].texture.wrapS=a[h].wrapT=THREE.RepeatWrapping,a[h].texture.needsUpdate=!0,c["texture_"+h]={type:"t",value:a[h].texture},d+="uniform sampler2D texture_"+h+";\n",0!==h){var j=a[h].levels,k=a[h].glsl,l=void 0!==j,m=a[h].texture.repeat,n=a[h].texture.offset;if(l){j[1]-j[0]<1&&(j[0]-=1),j[3]-j[2]<1&&(j[3]+=1);for(var o=0;o<j.length;o++)j[o]=b(j[o])}var p=l?"1.0 - smoothstep("+j[0]+", "+j[1]+", vPosition.z) + smoothstep("+j[2]+", "+j[3]+", vPosition.z)":k;e+="        color = mix( texture2D( texture_"+h+", MyvUv * vec2( "+b(m.x)+", "+b(m.y)+" ) + vec2( "+b(n.x)+", "+b(n.y)+" ) ), color, max(min("+p+", 1.0), 0.0));\n"}var q={fog:!0,lights:!0,uniforms:c,vertexShader:THREE.ShaderLib.lambert.vertexShader.replace("void main() {","varying vec2 MyvUv;\nvarying vec3 vPosition;\nvarying vec3 myNormal; void main() {\nMyvUv = uv;\nvPosition = position;\nmyNormal = normal;"),fragmentShader:["uniform vec3 diffuse;","uniform vec3 emissive;","uniform float opacity;","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","    varying vec3 vLightBack;","#endif",THREE.ShaderChunk.common,THREE.ShaderChunk.packing,THREE.ShaderChunk.dithering_pars_fragment,THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.uv_pars_fragment,THREE.ShaderChunk.uv2_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.alphamap_pars_fragment,THREE.ShaderChunk.aomap_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.emissivemap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.bsdfs,THREE.ShaderChunk.lights_pars_begin,THREE.ShaderChunk.lights_pars_maps,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.shadowmask_pars_fragment,THREE.ShaderChunk.specularmap_pars_fragment,THREE.ShaderChunk.logdepthbuf_pars_fragment,THREE.ShaderChunk.clipping_planes_pars_fragment,d,"varying vec2 MyvUv;","varying vec3 vPosition;","varying vec3 myNormal;","void main() {",THREE.ShaderChunk.clipping_planes_fragment,"ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );","vec3 totalEmissiveRadiance = emissive;","float slope = acos(max(min(dot(myNormal, vec3(0.0, 0.0, 1.0)), 1.0), -1.0));","    vec4 diffuseColor = vec4( diffuse, opacity );","    vec4 color = texture2D( texture_0, MyvUv * vec2( "+b(f.x)+", "+b(f.y)+" ) + vec2( "+b(g.x)+", "+b(g.y)+" ) ); // base",e,"    diffuseColor = color;",THREE.ShaderChunk.logdepthbuf_fragment,THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.alphamap_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.specularmap_fragment,THREE.ShaderChunk.emissivemap_fragment,"   reflectedLight.indirectDiffuse = getAmbientLightIrradiance( ambientLightColor );",THREE.ShaderChunk.lightmap_fragment,"    reflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );","    #ifdef DOUBLE_SIDED","            reflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;","    #else","            reflectedLight.directDiffuse = vLightFront;","    #endif","    reflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();",THREE.ShaderChunk.aomap_fragment,"   vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;",THREE.ShaderChunk.normal_flip,THREE.ShaderChunk.envmap_fragment,"   gl_FragColor = vec4( outgoingLight, diffuseColor.a );",THREE.ShaderChunk.tonemapping_fragment,THREE.ShaderChunk.encodings_fragment,THREE.ShaderChunk.fog_fragment,THREE.ShaderChunk.premultiplied_alpha_fragment,THREE.ShaderChunk.dithering_fragment,"}"].join("\n")};return new THREE.ShaderMaterial(q)},THREE.Terrain.ScatterMeshes=function(a,b){if(!b.mesh)return console.error("options.mesh is required for THREE.Terrain.ScatterMeshes but was not passed"),void 0;if(a instanceof THREE.BufferGeometry)return console.warn("The terrain mesh is using BufferGeometry but THREE.Terrain.ScatterMeshes can only work with Geometry."),void 0;b.scene||(b.scene=new THREE.Object3D);var c={spread:.025,smoothSpread:0,sizeVariance:.1,randomness:Math.random,maxSlope:.6283185307179586,maxTilt:1/0,w:0,h:0};for(var d in c)c.hasOwnProperty(d)&&(b[d]=void 0===b[d]?c[d]:b[d]);var e="number"==typeof b.spread,f,g,h=1/b.smoothSpread,i=2*b.sizeVariance,j=a.vertices,k=[],l=b.mesh.up.clone().applyAxisAngle(new THREE.Vector3(1,0,0),.5*Math.PI);e&&(f=b.randomness(),g="number"==typeof f?Math.random:function(a){return f[a]});for(var m=0,n=2*b.w;m<n;m++)for(var o=0,p=b.h;o<p;o++){var q=o*n+m,r=a.faces[q],s=!1;if(e){var t=g(q);t<b.spread?s=!0:t<b.spread+b.smoothSpread&&(s=THREE.Terrain.EaseInOut((t-b.spread)*h)*b.spread>Math.random())}else s=b.spread(j[r.a],q,r,m,o);if(s){if(r.normal.angleTo(l)>b.maxSlope)continue;var u=b.mesh.clone();if(u.position.copy(j[r.a]).add(j[r.b]).add(j[r.c]).divideScalar(3),b.maxTilt>0){var v=u.position.clone().add(r.normal);u.lookAt(v);var w=r.normal.angleTo(l);if(w>b.maxTilt){var x=b.maxTilt/w;u.rotation.x*=x,u.rotation.y*=x,u.rotation.z*=x}}if(u.rotation.x+=.5*Math.PI,u.rotateY(2*Math.random()*Math.PI),b.sizeVariance){var y=Math.random()*i-b.sizeVariance;u.scale.x=u.scale.z=1+y,u.scale.y+=y}k.push(u)}}var z,A;if(b.mesh.geometry instanceof THREE.Geometry){var B=new THREE.Geometry;for(z=0,A=k.length;z<A;z++){var C=k[z];C.updateMatrix(),B.merge(C.geometry,C.matrix)}b.scene.add(new THREE.Mesh(B,b.mesh.material))}else for(z=0,A=k.length;z<A;z++)b.scene.add(k[z]);return b.scene},THREE.Terrain.ScatterHelper=function(a,b,c,d){c=c||1,d=d||.25,b.frequency=b.frequency||2.5;var e={};for(var f in b)b.hasOwnProperty(f)&&(e[f]=b[f]);e.xSegments*=2,e.stretch=!0,e.maxHeight=1,e.minHeight=0;for(var g=THREE.Terrain.heightmapArray(a,e),h=0,i=g.length;h<i;h++)(h%c||Math.random()>d)&&(g[h]=1);return function(){return g}},THREE.Terrain.Influences={Mesa:function(a){return 1.25*Math.min(.8,Math.exp(-a*a))},Hole:function(a){return-THREE.Terrain.Influences.Mesa(a)},Hill:function(a){return a<0?(a+1)*(a+1)*(3-2*(a+1)):1-a*a*(3-2*a)},Valley:function(a){return-THREE.Terrain.Influences.Hill(a)},Dome:function(a){return-(a+1)*(a-1)},Flat:function(a){return 0},Volcano:function(a){return.94-.32*(Math.abs(2*a)+Math.cos(2*Math.PI*Math.abs(a)+.4))}},THREE.Terrain.Influence=function(a,b,c,d,e,f,g,h,i){c=c||THREE.Terrain.Influences.Hill,d=void 0===d?.5:d,e=void 0===e?.5:e,f=void 0===f?64:f,g=void 0===g?64:g,h=void 0===h?THREE.NormalBlending:h,i=i||THREE.Terrain.EaseIn;for(var j=b.xSegments+1,k=b.ySegments+1,l=j*d,m=k*e,n=b.xSize/b.xSegments,o=b.ySize/b.ySegments,p=f/n,q=f/o,r=1/f,s=Math.ceil(l-p),t=Math.floor(l+p),u=Math.ceil(m-q),v=Math.floor(m+q),w=s;w<t;w++)for(var x=u;x<v;x++){var y=x*j+w,z=(w-l)*n,A=(x-m)*o,B=Math.sqrt(z*z+A*A),C=B*r,D=z*r,E=A*r,F=c(C,D,E)*g*(1-i(C,D,E));B>f||void 0===a[y]||(h===THREE.AdditiveBlending?a[y].z+=F:h===THREE.SubtractiveBlending?a[y].z-=F:h===THREE.MultiplyBlending?a[y].z*=F:h===THREE.NoBlending?a[y].z=F:h===THREE.NormalBlending?a[y].z=i(C,D,E)*a[y].z+F:"function"==typeof h&&(a[y].z=h(a[y].z,F,C,D,E)))}};
//# sourceMappingURL=THREE.Terrain.min.js.map
